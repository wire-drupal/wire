<?php

/**
 * @file
 * Main module file.
 */

/**
 * Implements hook_page_attachments().
 */
function wire_page_attachments(array &$page): void {

  $request = Drupal::request();
  $container = \Drupal::getContainer();

  // Add needed values.
  $page['#attached']['drupalSettings'] = [
    'wireAppUrl' => $request->getSchemeAndHttpHost(),
    'wireIsDebug' => $container->hasParameter('twig.config')
      && \is_array($container->getParameter('twig.config'))
      && $container->getParameter('twig.config')['debug'],
  ];

  // Add CSRF token to the page for authenticated users.
  if (!\Drupal::currentUser()->isAnonymous()) {
    $token = \Drupal::csrfToken()->get($request->getPathInfo());
    $page['#attached']['html_head'][] = [
      [
        '#tag' => 'meta',
        '#attributes' => [
          'name' => 'w-csrf-token',
          'content' => $token,
        ],
      ],
      'wire-csrf-token',
    ];
  }

}
